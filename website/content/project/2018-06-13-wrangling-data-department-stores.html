---
title: Wrangling Data - Department Stores
author: Tiana Bell
date: '2018-06-13'
slug: wrangling-data-department-stores
categories:
  - R
  - Data Wrangling
  - Data Tidying
tags:
  - analysis
  - dataviz
  - R
  - Welcome
  - Entry Level
summary: 'Basic Data Wrangling and Tidying'
image_preview: 'boards.jpg'
header:
  image: 'boards.jpg'
---



<p>This blog post is to showcase earlier stages of learning data wrangling and tidying with R and RStudio.</p>
<p><a href="https://data.world/retail/department-store-sales">Data Set 1</a>: Sales from the Retail Trade and Food Services Report from the US Census. This dataset only covers Department Stores, though the report covers a wide range of retail types. [1992-2016]</p>
<p><a href="https://data.world/garyhoov/retail-sales-growth">Data Set 2</a> US Retail Sales by Store Type with Growth Rate [2009-2014]</p>
<pre class="r"><code>#1992-2016
#https://data.world/retail/department-store-sales

GET(&quot;https://query.data.world/s/gdk7iwtlisq6vkktmybqqr7hjjty5s&quot;, write_disk(tf &lt;- tempfile(fileext = &quot;.xls&quot;)))</code></pre>
<pre class="r"><code>df1 &lt;- read_excel(tf)

#2009-2014
# https://data.world/garyhoov/retail-sales-growth
GET(&quot;https://query.data.world/s/py7kinxvyuxjpzwdjs2ti4wdmui6bi&quot;, write_disk(tf &lt;- tempfile(fileext = &quot;.xls&quot;)))</code></pre>
<pre class="r"><code>df2 &lt;- read_excel(tf)
## the the first row and make that the column names of the data frame
colnames(df2) &lt;- df2[1,]</code></pre>
<pre class="r"><code>## use saveRDS() to save each object as a .rds file 
saveRDS(df1, file = &quot;df1.rds&quot;)
saveRDS(df2, file = &quot;df2.rds&quot;)
df_department.rds &lt;- readRDS(&quot;df1.rds&quot;)
df_retail.rds &lt;- readRDS(&quot;df2.rds&quot;)</code></pre>
<pre class="r"><code>## an example working with df2
## let&#39;s wrangle!
df_retail &lt;- df2 %&gt;%
  ## remove the r from the column names of df2
  magrittr::set_colnames(gsub(&quot;r&quot;,&quot;&quot;,df2[1,])) %&gt;% 
  ## add a new column called &quot;business&quot;
  mutate(business = gsub(&quot;[…]|[.]&quot;,&quot;&quot;,`Kind of business`)) %&gt;%
  ## filter to include Retail sales or Department stores sales
  filter(grepl(&#39;Retail sales, total |Department stores&#39;, business)) %&gt;%
  ## only look at columns with year information in them
  select(.,c(matches(&#39;19|20&#39;),business)) %&gt;%
  ## take year column and collapse them into a single column
  gather(., &quot;year&quot;, &quot;n&quot;, 1:(ncol(.)-1)) %&gt;%
  ## make sure the count column `n` is numeric
  mutate(n=as.numeric(n)) %&gt;%
  ## filter to only include the businesses we&#39;re interested in
  filter(business == &quot;Retail sales, total &quot;| business==&quot;Department stores &quot;)</code></pre>
<p>In this example code chunk we are manipulating the data to create a new column and a dataset. The current code will have added a new ‘business’ column and then manipulated the data do that only Retail and Department stores are showing.</p>
<pre class="r"><code>## work with df1
df_department &lt;- df1 %&gt;% 
  ## split Period column into one column called &quot;month&quot; and one called &quot;year&quot;
  separate(Period, into = c(&#39;month&#39;,&#39;year&#39;), extra = &#39;drop&#39;, remove = FALSE) %&gt;%
  ## add a column `value` which contains the 
  ## information from the `Value (in millions)` 
  mutate(value = `Value (in millions)`) %&gt;%
  ## group the data frame by the `year` column
  group_by(year) %&gt;%
  ## Summarize the data by creating a new column
  ## call this column `n` 
  ## have it contain the sum of the `value` column
  summarize(n = sum(value)) %&gt;% 
  ### create a new column called `business`
  ## set the value of this column to  be &quot;department stores&quot; 
  ## for the entire data set 
  mutate(business = &quot;department stores&quot;) %&gt;%
  ## reorder column names
  select(business, year, n)</code></pre>
<p>This code chunk has added the new columns: value and business.</p>
<pre class="r"><code>## Now, combine the two data frames
df_total &lt;- bind_rows(df_department, df_retail)</code></pre>
<pre class="r"><code>## Plot Retail Sales data
ggplot(df_retail, aes(x=year,y=n,colour=business)) +
  geom_point() </code></pre>
<p><img src="/project/2018-06-13-wrangling-data-department-stores_files/figure-html/plot-1.png" width="960" /></p>
<pre class="r"><code>## Plot Department Sales data
ggplot(df_department, aes(x=year,y=n)) +
  geom_point() </code></pre>
<p><img src="/project/2018-06-13-wrangling-data-department-stores_files/figure-html/plot-2.png" width="960" /></p>
<pre class="r"><code>## Plot Combined Data
ggplot(df_total, aes(x=year,y= as.numeric(n), colour=business)) +
  geom_point()</code></pre>
<p><img src="/project/2018-06-13-wrangling-data-department-stores_files/figure-html/plot-3.png" width="960" /></p>
